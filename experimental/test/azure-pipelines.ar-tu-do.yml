trigger: none
pr: none

variables:
  ROS_DISTRO: 'noetic'
  INSTALL_DIR: 'c:\opt\ros\noetic\x64'

jobs:
- job: Test
  pool: 'Edge-Robotics-VS2019-GPU'
  timeoutInMinutes: 360
  workspace:
    clean: all
  steps:
  - script: |
      rd /s /q c:\opt 2>&1
      exit 0
    displayName: 'Remove opt folder'
  - powershell: |
      $env:ChocolateyInstall="c:\opt\chocolatey"
      Set-ExecutionPolicy Bypass -Scope Process -Force;
      iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
      choco sources add -n=roswin -s https://aka.ms/ros/public --priority 1
      choco install ros-noetic-desktop_full -y --pre --no-progress -i
    displayName: 'Install Noetic'
  - script: |
      git clone https://github.com/ms-iot/ros_simulation_lab --recursive
      cd ros_simulation_lab
      call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvars64.bat"
      call "c:\opt\ros\noetic\x64\setup.bat"
      catkin_make --use-ninja
    displayName: 'Build'
