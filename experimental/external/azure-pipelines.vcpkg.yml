trigger: none
pr: none

jobs:
- job: Vcpkg
  pool: Edge-Robotics-VS2019
  timeoutInMinutes: 360
  strategy:
    matrix:
      x64-windows:
        VCPKG_DEFAULT_TRIPLET: 'x64-windows'
  workspace:
    clean: all
  steps:
  - script: |
      rd /s /q d:\bld
      mkdir d:\bld
    displayName: 'Create buildtrees'
  - script: |
      git clone https://github.com/seanyen/vcpkg.git -b seanyen/739209b51aaa125a41919f23206c110e79023ce8
      call ".\vcpkg\bootstrap-vcpkg.bat"
      cd vcpkg
      vcpkg version
      vcpkg install @..\experimental\external\vcpkg.in --x-buildtrees-root=d:\bld
  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: .\vcpkg\installed\
      includeRootFolder: false
      archiveType: 'zip' # Options: zip, 7z, tar, wim
      tarCompression: 'gz' # Optional. Options: gz, bz2, xz, none
      archiveFile: '$(Build.ArtifactStagingDirectory)/$(VCPKG_DEFAULT_TRIPLET).zip'
      replaceExistingArchive: true
    condition: always()
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: '$(Build.ArtifactStagingDirectory)/$(VCPKG_DEFAULT_TRIPLET).zip'
      artifactName: 'vcpkg-drop'
